import json
from datetime import datetime
import logging
import os

logger = logging.getLogger(__name__)
TRADES_LOG_FILE = "trades.jsonl"

def _append_trade_log(entry: dict):
    """
    Acrescenta um registro de trade no arquivo trades.jsonl.
    Cada linha √© um JSON independente, contendo:
    - timestamp UTC da grava√ß√£o
    - tipo da opera√ß√£o (buy, sell, etc.)
    - pre√ßo de refer√™ncia (USD, ETH...)
    - quantidade operada (ETH/tokens)
    - hash da transa√ß√£o (real ou simulado)
    - status de sucesso
    """
    try:
        # Acrescenta timestamp e serializa para JSON
        entry = {"timestamp": datetime.utcnow().isoformat(), **entry}
        with open(TRADES_LOG_FILE, "a") as f:
            f.write(json.dumps(entry) + "\n")
        logger.info(f"üìù Trade registrado: {entry}")
    except Exception as e:
        logger.warning(f"Falha ao gravar log de trade: {e}")
